<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, user-scalable=no">
  <meta name="description" content="api_kit API docs, for the Dart programming language.">
  <title>api_kit - Dart API docs</title>


  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
  
  <link rel="stylesheet" href="static-assets/github.css?v1">
  <link rel="stylesheet" href="static-assets/styles.css?v1">
  <link rel="icon" href="static-assets/favicon.png?v1">
  
</head>

<body data-base-href="" data-using-base-href="false" class="light-theme">
<div id="overlay-under-drawer"></div>
<header id="title">
  <span id="sidenav-left-toggle" class="material-symbols-outlined" role="button" tabindex="0">menu</span>
  <ol class="breadcrumbs gt-separated dark hidden-xs">
    <li><a href="https://github.com/jhonacode/api_kit">api_kit package</a></li>
  </ol>
  <div class="self-name">api_kit</div>
  <form class="search navbar-right" role="search">
    <input type="text" id="search-box" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
  <button class="toggle" id="theme-button" title="Toggle between light and dark mode" aria-label="Light and dark mode toggle">
    <span id="dark-theme-button" class="material-symbols-outlined" aria-hidden="true">
      dark_mode
    </span>
    <span id="light-theme-button" class="material-symbols-outlined" aria-hidden="true">
      light_mode
    </span>
  </button>
</header>
<main>
  <div id="dartdoc-main-content" class="main-content">
      
<section class="desc markdown">
  <h1 id="api_kit">api_kit</h1>
<p>Production-ready REST API framework with annotation-based routing and comprehensive JWT validation system. Perfect for MVPs, rapid prototyping, and enterprise applications.</p>
<h2 id="features">Features</h2>
<ul>
<li><strong>üöÄ Annotation-based routing</strong>: Just add @GET, @POST, etc. and you're done</li>
<li><strong>üîê JWT Authentication System</strong>: Complete JWT validation with custom validators</li>
<li><strong>‚ö° Fast setup</strong>: Perfect for MVPs and rapid prototyping</li>
<li><strong>üì¶ Controller lists</strong>: Register controllers like simple_rest</li>
<li><strong>üîÑ Result pattern</strong>: Clean error handling with result_controller</li>
<li><strong>üìù Built-in logging</strong>: Structured logging with logger_rs</li>
<li><strong>üõ°Ô∏è Production security</strong>: Enterprise-grade security features</li>
<li><strong>üéØ Flexible validation</strong>: Custom validators with AND/OR logic</li>
<li><strong>‚öñÔ∏è Token blacklisting</strong>: Advanced token management system</li>
</ul>
<h2 id="getting-started">Getting started</h2>
<p>Add this to your <code>pubspec.yaml</code>:</p>
<pre class="language-yaml"><code class="language-yaml">dependencies:
  api_kit: ^0.0.2
</code></pre>
<h2 id="quick-start">Quick Start</h2>
<pre class="language-dart"><code class="language-dart">import 'dart:io';
import 'package:shelf/shelf.dart';
import 'package:api_kit/api_kit.dart';

void main() async {
  // Create API server with JWT configuration
  final server = ApiServer(config: ServerConfig.production());
  
  // Configure JWT authentication
  server.configureJWTAuth(
    jwtSecret: 'your-256-bit-secret-key-here',
    excludePaths: ['/api/public', '/health'],
  );

  // Start server with controllers
  final result = await server.start(
    host: 'localhost',
    port: 8080,
    controllerList: [UserController(), AdminController()],
  );
  
  result.when(
    ok: (httpServer) =&gt; print('üöÄ Server running on http://localhost:8080'),
    err: (error) =&gt; print('‚ùå Failed to start: ${error.msm}'),
  );
}
</code></pre>
<h2 id="basic-controller">Basic Controller</h2>
<pre class="language-dart"><code class="language-dart">@Controller('/api/v1/users')
class UserController extends BaseController {

  @GET('/') // GET /api/v1/users/
  Future&lt;Response&gt; getUsers(Request request) async {
    logRequest(request, 'Getting users');
    
    final response = ApiResponse.success(['user1', 'user2']);
    return jsonResponse(response.toJson());
  }

  @GET('/&lt;id&gt;') // GET /api/v1/users/&lt;id&gt;
  Future&lt;Response&gt; getUser(Request request) async {
    final id = getRequiredParam(request, 'id');
    final response = ApiResponse.success({'id': id, 'name': 'User $id'});
    return jsonResponse(response.toJson());
  }
}
</code></pre>
<h2 id="jwt-authentication-system">JWT Authentication System</h2>
<h3 id="jwt-annotations">JWT Annotations</h3>
<p>api_kit provides three powerful JWT annotations for complete access control:</p>
<h4 id="jwtpublic---public-endpoints"><strong>@JWTPublic</strong> - Public Endpoints</h4>
<pre class="language-dart"><code class="language-dart">@Controller('/api/public')
class PublicController extends BaseController {
  @GET('/info')
  @JWTPublic() // ‚úÖ No JWT required - always accessible
  Future&lt;Response&gt; getPublicInfo(Request request) async {
    return jsonResponse({'message': 'Public data'});
  }
}
</code></pre>
<h4 id="jwtcontroller---controller-level-protection"><strong>@JWTController</strong> - Controller-Level Protection</h4>
<pre class="language-dart"><code class="language-dart">@Controller('/api/admin')
@JWTController([
  const MyAdminValidator(),
  const MyBusinessHoursValidator(),
], requireAll: true) // üîí ALL validators must pass (AND logic)
class AdminController extends BaseController {
  
  @GET('/users')
  Future&lt;Response&gt; getUsers(Request request) async {
    // Protected by controller-level validation
    final jwtPayload = request.context['jwt_payload'] as Map&lt;String, dynamic&gt;;
    return jsonResponse({'users': [], 'admin': jwtPayload['name']});
  }
}
</code></pre>
<h4 id="jwtendpoint---endpoint-level-override"><strong>@JWTEndpoint</strong> - Endpoint-Level Override</h4>
<pre class="language-dart"><code class="language-dart">@Controller('/api/finance')
@JWTController([
  const MyDepartmentValidator(allowedDepartments: ['finance']),
])
class FinanceController extends BaseController {
  
  @GET('/reports')
  Future&lt;Response&gt; getReports(Request request) async {
    // Uses controller validation (department = finance)
  }
  
  @POST('/transactions')
  @JWTEndpoint([
    const MyFinancialValidator(minimumAmount: 10000),
    const MyAdminValidator(),
  ], requireAll: false) // üîÄ Either validator can pass (OR logic)
  Future&lt;Response&gt; createTransaction(Request request) async {
    // Override: Either financial validator OR admin validator
  }
}
</code></pre>
<h3 id="custom-jwt-validators">Custom JWT Validators</h3>
<p>Create your own validators by extending <code>JWTValidatorBase</code>:</p>
<h4 id="basic-admin-validator">Basic Admin Validator</h4>
<pre class="language-dart"><code class="language-dart">class MyAdminValidator extends JWTValidatorBase {
  const MyAdminValidator();
  
  @override
  ValidationResult validate(Request request, Map&lt;String, dynamic&gt; jwtPayload) {
    final role = jwtPayload['role'] as String?;
    final isActive = jwtPayload['active'] as bool? ?? false;
    final permissions = jwtPayload['permissions'] as List&lt;dynamic&gt;? ?? [];
    
    if (role != 'admin') {
      return ValidationResult.invalid('Administrator role required');
    }
    
    if (!isActive) {
      return ValidationResult.invalid('Account is inactive');
    }
    
    if (!permissions.contains('admin_access')) {
      return ValidationResult.invalid('Missing admin access permission');
    }
    
    return ValidationResult.valid();
  }
  
  @override
  String get defaultErrorMessage =&gt; 'Administrator access required';
}
</code></pre>
<h4 id="advanced-financial-validator">Advanced Financial Validator</h4>
<pre class="language-dart"><code class="language-dart">class MyFinancialValidator extends JWTValidatorBase {
  final double minimumAmount;
  
  const MyFinancialValidator({this.minimumAmount = 0.0});
  
  @override
  ValidationResult validate(Request request, Map&lt;String, dynamic&gt; jwtPayload) {
    final department = jwtPayload['department'] as String?;
    final clearanceLevel = jwtPayload['clearance_level'] as int? ?? 0;
    final certifications = jwtPayload['certifications'] as List&lt;dynamic&gt;? ?? [];
    final maxTransactionAmount = jwtPayload['max_transaction_amount'] as double? ?? 0.0;
    
    // Validate department
    if (department != 'finance' &amp;&amp; department != 'accounting') {
      return ValidationResult.invalid('Access restricted to financial departments');
    }
    
    // Validate clearance level
    if (clearanceLevel &lt; 3) {
      return ValidationResult.invalid('Insufficient clearance level for financial operations');
    }
    
    // Validate certifications
    if (!certifications.contains('financial_ops_certified')) {
      return ValidationResult.invalid('Financial operations certification required');
    }
    
    // Validate transaction amount limits
    if (minimumAmount &gt; 0 &amp;&amp; maxTransactionAmount &lt; minimumAmount) {
      return ValidationResult.invalid('Transaction amount exceeds user authorization limit');
    }
    
    return ValidationResult.valid();
  }
  
  @override
  String get defaultErrorMessage =&gt; 'Financial operations access required';
}
</code></pre>
<h3 id="jwt-configuration-options">JWT Configuration Options</h3>
<pre class="language-dart"><code class="language-dart">void main() async {
  final server = ApiServer(config: ServerConfig.production());
  
  // Configure JWT with all options
  server.configureJWTAuth(
    jwtSecret: 'your-256-bit-secret-key-for-production',
    excludePaths: ['/api/public', '/health', '/docs'],
  );
  
  // Token blacklist management
  server.blacklistToken('jwt-token-to-invalidate');
  server.clearTokenBlacklist();
  print('Blacklisted tokens: ${server.blacklistedTokensCount}');
  
  // Dynamic configuration changes
  server.disableJWTAuth(); // Temporarily disable
  server.configureJWTAuth(jwtSecret: 'new-secret'); // Re-enable with new config
}
</code></pre>
<h3 id="jwt-payload-access">JWT Payload Access</h3>
<p>Access JWT data in your endpoints:</p>
<pre class="language-dart"><code class="language-dart">@GET('/profile')
Future&lt;Response&gt; getProfile(Request request) async {
  // Full JWT payload
  final jwtPayload = request.context['jwt_payload'] as Map&lt;String, dynamic&gt;;
  
  // Convenient shortcuts
  final userId = request.context['user_id'] as String?;
  final userEmail = request.context['user_email'] as String?;
  final userRole = request.context['user_role'] as String?;
  
  return jsonResponse({
    'user_id': jwtPayload['user_id'],
    'email': jwtPayload['email'],
    'name': jwtPayload['name'],
    'custom_data': jwtPayload['custom_field'],
    // All JWT claims available
  });
}
</code></pre>
<h2 id="validation-logic">Validation Logic</h2>
<h3 id="and-logic-requireall-true">AND Logic (requireAll: true)</h3>
<pre class="language-dart"><code class="language-dart">@JWTController([
  const MyAdminValidator(),
  const MyBusinessHoursValidator(),
], requireAll: true) // ‚úÖ BOTH validators must pass
</code></pre>
<h3 id="or-logic-requireall-false">OR Logic (requireAll: false)</h3>
<pre class="language-dart"><code class="language-dart">@JWTController([
  const MyAdminValidator(),
  const MyDepartmentValidator(allowedDepartments: ['support']),
], requireAll: false) // ‚úÖ EITHER validator can pass
</code></pre>
<h2 id="built-in-validators">Built-in Validators</h2>
<p>api_kit includes production-ready validators:</p>
<h3 id="myadminvalidator">MyAdminValidator</h3>
<ul>
<li>Validates <code>role: 'admin'</code></li>
<li>Checks <code>active: true</code></li>
<li>Requires <code>permissions: ['admin_access']</code></li>
</ul>
<h3 id="myfinancialvalidator">MyFinancialValidator</h3>
<ul>
<li>Department validation (finance/accounting)</li>
<li>Clearance level requirements</li>
<li>Certification validation</li>
<li>Transaction amount limits</li>
</ul>
<h3 id="mydepartmentvalidator">MyDepartmentValidator</h3>
<ul>
<li>Configurable allowed departments</li>
<li>Optional management level requirements</li>
<li>Employee level validation</li>
</ul>
<h3 id="mybusinesshoursvalidator">MyBusinessHoursValidator</h3>
<ul>
<li>Working hours validation (configurable)</li>
<li>Business days only</li>
<li>After-hours access override</li>
</ul>
<h2 id="error-responses">Error Responses</h2>
<p>Consistent error handling with detailed information:</p>
<h3 id="401-unauthorized-noinvalid-jwt">401 Unauthorized (No/Invalid JWT)</h3>
<pre class="language-json"><code class="language-json">{
  "success": false,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "JWT token required",
    "status_code": 401
  },
  "timestamp": "2024-01-15T10:30:00.000Z",
  "request_id": "req_123456"
}
</code></pre>
<h3 id="403-forbidden-jwt-valid-authorization-failed">403 Forbidden (JWT Valid, Authorization Failed)</h3>
<pre class="language-json"><code class="language-json">{
  "success": false,
  "error": {
    "code": "FORBIDDEN",
    "message": "Administrator access required",
    "status_code": 403,
    "details": {
      "validation_mode": "require_all",
      "validators_count": 2,
      "failed_validations": ["Administrator role required"]
    }
  },
  "timestamp": "2024-01-15T10:30:00.000Z",
  "request_id": "req_123456"
}
</code></pre>
<h2 id="available-annotations">Available Annotations</h2>
<h3 id="http-methods">HTTP Methods</h3>
<ul>
<li><code>@GET('/path')</code>, <code>@POST('/path')</code>, <code>@PUT('/path')</code>, <code>@DELETE('/path')</code>, <code>@PATCH('/path')</code></li>
</ul>
<h3 id="jwt-authentication">JWT Authentication</h3>
<ul>
<li><code>@JWTPublic()</code> - Public endpoint (no JWT required)</li>
<li><code>@JWTController([validators], requireAll: bool)</code> - Controller-level protection</li>
<li><code>@JWTEndpoint([validators], requireAll: bool)</code> - Endpoint-level protection</li>
</ul>
<h3 id="controllers">Controllers</h3>
<ul>
<li><code>@Controller('/base/path')</code> - Define base path for controller</li>
</ul>
<h2 id="path-parameters">Path Parameters</h2>
<p>Access path parameters using helper methods:</p>
<pre class="language-dart"><code class="language-dart">@GET('/users/&lt;userId&gt;/posts/&lt;postId&gt;')
Future&lt;Response&gt; getUserPost(Request request) async {
  final userId = getRequiredParam(request, 'userId');
  final postId = getRequiredParam(request, 'postId');
  
  return jsonResponse({
    'user_id': userId,
    'post_id': postId,
    'data': 'User $userId post $postId'
  });
}
</code></pre>
<h2 id="security-features">Security Features</h2>
<h3 id="automatic-security-headers">Automatic Security Headers</h3>
<ul>
<li><code>X-Frame-Options: DENY</code></li>
<li><code>X-Content-Type-Options: nosniff</code></li>
<li><code>X-XSS-Protection: 1; mode=block</code></li>
<li><code>Strict-Transport-Security</code></li>
<li><code>Content-Security-Policy</code></li>
</ul>
<h3 id="jwt-token-blacklisting">JWT Token Blacklisting</h3>
<pre class="language-dart"><code class="language-dart">// Blacklist a specific token
server.blacklistToken('eyJhbGciOiJIUzI1NiIs...');

// Check blacklist size
print('Blacklisted tokens: ${server.blacklistedTokensCount}');

// Clear all blacklisted tokens
server.clearTokenBlacklist();
</code></pre>
<h3 id="rate-limiting">Rate Limiting</h3>
<pre class="language-dart"><code class="language-dart">final config = ServerConfig(
  rateLimit: RateLimitConfig(
    maxRequests: 100,
    window: Duration(minutes: 1),
    maxRequestsPerIP: 1000,
  ),
);
</code></pre>
<h2 id="reflection-support">Reflection Support</h2>
<p>The framework automatically detects if reflection is available:</p>
<ul>
<li><strong>With Reflection</strong> (Dart VM): Annotations work automatically via <code>dart:mirrors</code></li>
<li><strong>Without Reflection</strong> (Flutter Web): Falls back to manual route registration</li>
</ul>
<pre class="language-dart"><code class="language-dart">@Controller('/api/v1/products')
class ProductController extends BaseController {
  @override
  Router get router {
    if (ReflectionHelper.isReflectionAvailable) {
      return super.router; // Automatic annotation-based routing
    }
    
    // Manual fallback for Flutter Web
    final router = Router();
    router.get('/', getProducts);
    router.post('/', createProduct);
    return router;
  }

  @GET('/')
  Future&lt;Response&gt; getProducts(Request request) async {
    // Works in both reflection and non-reflection environments
  }
}
</code></pre>
<h2 id="configuration">Configuration</h2>
<h3 id="production-configuration">Production Configuration</h3>
<pre class="language-dart"><code class="language-dart">final server = ApiServer(
  config: ServerConfig.production(),
);
</code></pre>
<h3 id="development-configuration">Development Configuration</h3>
<pre class="language-dart"><code class="language-dart">final server = ApiServer(
  config: ServerConfig.development(), // More permissive for development
);
</code></pre>
<h3 id="custom-configuration">Custom Configuration</h3>
<pre class="language-dart"><code class="language-dart">final config = ServerConfig(
  cors: CorsConfig.permissive(),
  rateLimit: RateLimitConfig(maxRequests: 1000),
  security: SecurityConfig.strict(),
);
</code></pre>
<h2 id="logging">Logging</h2>
<p>Uses <code>logger_rs</code> for structured logging:</p>
<pre class="language-dart"><code class="language-dart">Log.i('Server started successfully');
Log.w('Rate limit warning');
Log.e('Error occurred', error: error, stackTrace: stackTrace);

// JWT-specific logging
Log.i('üîê JWT authentication configured');
Log.w('üö´ Token added to blacklist');
Log.e('‚ùå JWT validation failed');
</code></pre>
<h2 id="production-deployment">Production Deployment</h2>
<h3 id="docker-example">Docker Example</h3>
<pre class="language-dockerfile"><code class="language-dockerfile">FROM dart:stable AS build

WORKDIR /app
COPY pubspec.* ./
RUN dart pub get

COPY . .
RUN dart compile exe bin/server.dart -o bin/server

FROM scratch
COPY --from=build /app/bin/server /app/bin/server
EXPOSE 8080
ENTRYPOINT ["/app/bin/server"]
</code></pre>
<h3 id="environment-variables">Environment Variables</h3>
<pre class="language-bash"><code class="language-bash">export JWT_SECRET="your-production-secret-key-256-bits-minimum"
export SERVER_PORT="8080"
export SERVER_HOST="0.0.0.0"
export LOG_LEVEL="INFO"
</code></pre>
<h2 id="testing">Testing</h2>
<p>The JWT system includes comprehensive tests:</p>
<pre class="language-bash"><code class="language-bash"># Run all tests
dart test

# Run JWT-specific tests
dart test test/jwt_validation_system_test.dart
dart test test/jwt_production_ready_test.dart

# Run with coverage
dart test --coverage=coverage
genhtml coverage/lcov.info -o coverage/html
</code></pre>
<h2 id="performance">Performance</h2>
<ul>
<li><strong>139/139 tests passing</strong> with 100% success rate</li>
<li><strong>Concurrent request handling</strong> tested and validated</li>
<li><strong>Token blacklisting</strong> with efficient lookup</li>
<li><strong>Reflection-based routing</strong> with fallback support</li>
<li><strong>Production-grade error handling</strong></li>
</ul>
<h2 id="migration-from-v001">Migration from v0.0.1</h2>
<h3 id="before-old-authentication">Before (Old Authentication)</h3>
<pre class="language-dart"><code class="language-dart">@Controller('/api/admin')
class AdminController extends BaseController {
  @GET('/users')
  @RequireAuth(role: 'admin')  // ‚ùå Old system
  Future&lt;Response&gt; getUsers(Request request) async {
    // ...
  }
}
</code></pre>
<h3 id="after-new-jwt-system">After (New JWT System)</h3>
<pre class="language-dart"><code class="language-dart">@Controller('/api/admin')
@JWTController([
  const MyAdminValidator(),
], requireAll: true)  // ‚úÖ New JWT system
class AdminController extends BaseController {
  @GET('/users')
  Future&lt;Response&gt; getUsers(Request request) async {
    // JWT payload automatically available in request.context
  }
}
</code></pre>
<h2 id="roadmap">Roadmap</h2>
<ul>
<li><code>x</code> JWT authentication system with custom validators</li>
<li><code>x</code> Token blacklisting and management</li>
<li><code>x</code> Comprehensive test coverage (139 tests)</li>
<li><code>x</code> Production-ready security headers</li>
<li><code>x</code> Error handling and logging</li>
<li><code> </code> Database integration helpers</li>
<li><code> </code> WebSocket support with JWT</li>
<li><code> </code> Metrics and monitoring</li>
<li><code> </code> OpenAPI/Swagger documentation generation</li>
<li><code> </code> Redis-based token blacklist for scaling</li>
</ul>
<h2 id="contributing">Contributing</h2>
<p>This library is production-ready with comprehensive test coverage. Contributions, suggestions, and feedback are welcome!</p>
<h3 id="development-setup">Development Setup</h3>
<pre class="language-bash"><code class="language-bash">git clone https://github.com/JhonaCodes/api_kit
cd api_kit
dart pub get
dart test
</code></pre>
<h2 id="license">License</h2>
<p>MIT License - see LICENSE file for details.</p>
<hr>
<p><strong>Built with ‚ù§Ô∏è for Jhonacode who need production-ready APIs fast.</strong></p>
</section>


      <section class="summary">
          <h2>Libraries</h2>
        <dl>
          <dt id="api_kit">
  <span class="name"><a href="api_kit/">api_kit</a></span> 

</dt>
<dd>Simple, fast REST API framework with annotation-based routing.
</dd>

        </dl>
      </section>
  </div> <!-- /.main-content -->
  <div id="dartdoc-sidebar-left" class="sidebar sidebar-offcanvas-left">
    <!-- The search input and breadcrumbs below are only responsively visible at low resolutions. -->
<header id="header-search-sidebar" class="hidden-l">
  <form class="search-sidebar" role="search">
    <input type="text" id="search-sidebar" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
</header>
<ol class="breadcrumbs gt-separated dark hidden-l" id="sidebar-nav">
    <li><a href="https://github.com/jhonacode/api_kit">api_kit package</a></li>
</ol>

    <h5 class="hidden-xs"><span class="package-name">api_kit</span> <span class="package-kind">package</span></h5>
    <ol>
      <li class="section-title">Libraries</li>
      <li><a href="api_kit/">api_kit</a></li>
</ol>

  </div>
  <div id="dartdoc-sidebar-right" class="sidebar sidebar-offcanvas-right">
  </div>
</main>
<footer>
  <span class="no-break">
    api_kit
      0.0.2
  </span>
  
</footer>


<script src="static-assets/highlight.pack.js?v1"></script>
<script src="static-assets/docs.dart.js"></script>

</body>
</html>

